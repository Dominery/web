# 函数上下文

JavaScript中this表示函数上下文，总是指向一个对象，这个对象是在运行时基于函数的执行环境动态绑定的，并不是在编写时绑定，和函数声明的位置没有任何关系。

当函数没有被调用，则无法确定其上下文。

## 绑定规则

函数的调用方式决定了this的绑定对象。

### 默认绑定

当函数作为普通函数进行调用时，此时this绑定规则如下：

* 在非严格模式下，函数的上下文是window全局对象(在浏览器环境下)
* 在严格模式下，函数上下文是undefined(es5)

### 隐式绑定

当函数作为对象的方法进行调用时，this绑定了该对象，对象属性引用链中只有上一层或者说最后一层在调用位置中起作用。

### 显示绑定

大多函数都存在call和apply方法，它们第一个参数是一个对象，在调用函数时会将this绑定到该对象上。

**call和apply的区别**

call和apply的区别仅在于传入参数形式的不同。call接收多个参数，第二个及之后的参数作为被调用函数的参数，apply第二个参数是一个数组，数组中的元素会作为参数传给被调用函数。

### new绑定

当用new运算符调用函数时，该函数总会返回一个对象，通常情况下，构造器里的this就指向返回的这个对象



### 判定规则

判定规则中的函数不能是Lambda表达式。

1. 对象打点调用它的方法函数，则函数的上下文是这个打点的对象
2. 如果在浏览器中执行，圆括号直接调用函数，在非严格模式下，函数的上下文是window全局对象；在严格模式下，函数上下文是undefined
3. 数组（类数组对象)枚举出函数进行调用，上下文是这个数组（类数组对象)
4. IIFE中的函数，上下文是window对象
5. 定时器、延时器调用函数，上下文是window对象
6. 事件处理函数的上下文是绑定事件的DOM元素

如果内层函数需要使用外层函数的上下文，需要将上下文赋值给变量达到备份上下文的作用。



### new操作符调用函数

JS规定，使用new操作符调用函数，函数内的上下文是新创建的对象，过程有以下四步：

1. 函数体内会自动创建出一个空白对象
2. 函数的上下文 (this）会指向这个对象
3. 函数体内的语句会执行
4. 函数会自动返回上下文对象，如果函数没有return回一个对象

