# 数组

数组(Array)，是用来存储一组相关的值的数据结构。JavaScript中的数组可以存储任意类型的值，数组长度会动态变化。

**类数组对象**

类数组对象:所有属性均为从0开始的自然数序列,并且有length属性，和数组类似可以用方括号书写下标访问对象的某个属性值，但是不能调用数组的方法。

arguments对象是最常见的类数组对象。

可以通过以下方法将类数组对象转换为数组对象：

1. Array.from(arguments)
2. Array.prototype.slice.call(arguments)
3. [...arguments]
4. [...new Set(arguments)]
5. for...of遍历

## 数组的使用

数组是通过数字对属性值进行索引的对象，所以数组可以包含字符串键值和属性，但这并不计算在数组长度中。如果字符串键值能够被强制类型转换为十进制数字的话，它就会被当作数字索引来处理。

### 检测数组

数组用typeof检测结果是object

* instanceof
* Array.isArray()
* Object.prototype.toString()

虽然`instanceof`能够检测一个对象是否是数组，但`instanceof`操作符基于构造函数，如果存在多个版本的Array构造函数，那么该检测方法就无效。因而ECMAScript新增了Array.isArray()方法用来检测数组

### 创建数组方法

#### 字面量

使用数组字面量，数组字面量是在中括号中包含以逗号分隔的元素列表。

#### 构造函数

使用new创建对象，使用数组构造函数创建数组时，new关键字不是必须的

```javascript
var arr1 = [1,2,3,4,5];
var arr2 = new Array(1,2,3,4,5);
var arr3 = new Array(4);
```

`Array()`构造函数有一个很大的缺陷，不同的参数个数会导致不一致的行为。

* Array()没有参数返回[]
* Array(len)有一个参数返回长度为len的空数组
* Array(ele1, ele2)大于一个参数返回这些参数组成的数组

创建指定长度填充数字的数组

```javascript
new Array(num).fill(0);
[...new Array(num)].map(n=>0);
```

### 操作

#### 访问数组项

数组每一项都有下标，下标从0开始，可以使用方括号中书写下标的形式，访问数组的任一项

数组并不是只读的，我们可以修改它其中任何项的值，如果更改的数组项超过了length-1，则会创造这项

**下标越界**

JavaScript规定，访问数组中不存在的项会返回undefined，不会报错

数组的length属性表示它的长度

**数组的遍历**

```javascript
for (var i = 0; i < arr.length; i++) {
	console.log( arr[i]);
}
```

#### 数组展开运算符

展开运算符通过...将数组转换为参数列表形式。与剩余参数的运算过程刚好相反。

只有函数调用时，扩展运算符才可以放在圆括号中，否则会报错。

**应用**

* 克隆数组
* 合并数组
* 与解构赋值结合
* 字符串转为数组，能正确识别四个字节的Unicode
* 实现了Iterator接口的对象
* 替代函数的apply方法

## 数组方法

### 静态方法

| 方法            | 说明                           |
| --------------- | ------------------------------ |
| Array.from()    | 将其余的数据类型转换为数组 es6 |
| Array.of()      | 把一组参数转换为数组 es6       |
| Array.isArray() | 判断参数是否数组类             |

#### Array.from

可以转换的数据类型

* 原生可迭代对象
* 拥有length属性的任意对象，即类数组对象，只会将数字键的属性值转换为数组元素。

可以传入第二个参数函数，用来映射每个元素，类似map。第三个参数可以修改第二个参数函数this指向。

### 实例方法

| 方法        | 说明                                               |
| ----------- | -------------------------------------------------- |
| push()      | 把多个参数添加到数组的尾部，返回值是数组的新长度   |
| pop()       | 删除末项并返回，空数组返回undefined                |
| unshift()   | 把多个参数添加到数组的最前面，返回值是数组的新长度 |
| shift()     | 删除首项并返回                                     |
| splice()    | 替换数组中的指定项                                 |
| slice(a, b) | 截取[a,b)的子数组                                  |
| concat(a,b) | 合并数组a、b                                       |
| reverse()   | 将一个数组中项顺序置反，返回数组                   |
| indexOf()   | 搜索数组中的元素，并返回它所在的位置               |
| includes()  | 判断一个数组是否包含指定的值 es6                   |
| sort()      | 数组排序                                           |
| find()      | 找到满足条件的一个值返回 es6                       |
| findIndex() | 找到满足条件值的索引返回 es6                       |
| fill()      | 向一个已有的数组中插入全部或部分相同的值           |

* 改变原数组：fill()、pop()、push()、shift()、splice()、unshift()、reverse()、sort()
* 不改变原数组：concat()、 every()、 fiter(). find(). findIndex()、 forEach(). indexOf()、 join()、lastIndexOf()、map()、reduce()、 reduceRight()、 slice()、 some()。

#### 填充

##### fill()

fill方法使用给定值，填充一个数组。接收第二、三个参数，用于指定填充的起始位置和终止位置，如为负值表示从结尾开始。

如果填充的元素是对象类型，那么填充的是该对象的引用。

##### copyWithin()

数组实例的`copyWithin()`方法，在当前数组内部，将指定位置的成员复制到其他位置（会覆盖原有成员），然后返回当前数组。

```javascript
Array.prototype.copyWithin(target, start = 0, end = this.length)
```

它接受三个参数。

- target（必需）：从该位置开始替换数据。如果为负值，表示倒数。
- start（可选）：从该位置开始读取数据，默认为 0。如果为负值，表示从末尾开始计算。
- end（可选）：到该位置前停止读取数据，默认等于数组长度。如果为负值，表示从末尾开始计算。

#### 操作

##### concat()

`concat`方法用于多个数组的合并。它将新数组的成员，添加到原数组成员的后部，然后返回一个新数组，原数组不变。

除了数组作为参数，`concat`也接受其他类型的值作为参数，添加到目标数组尾部。

类数组对象会作为单个元素加入，除非类数组对象具有`Symbol.isConcatSpreadable`属性。

##### slice()

`slice()`方法用于提取目标数组的一部分，返回一个新数组，原数组不变。

第一个参数为起始位置（从0开始，会包括在返回的新数组之中），第二个参数为终止位置（但该位置的元素本身不包括在内）。如果省略第二个参数，则一直返回到原数组的最后一个成员。

* 如果`slice()`方法的参数是负数，则表示倒数计算的位置。
* 如果第一个参数大于等于数组长度，或者第二个参数小于第一个参数，则返回空数组。

##### splice()

`splice()`方法用于删除原数组的一部分成员，并可以在删除的位置添加新的数组成员，返回值是被删除的元素构成的数组。

第一个参数是删除的起始位置（从0开始），第二个参数是被删除的元素个数，默认数组长度减去第一个参数。如果后面还有更多的参数，则表示这些就是要被插入数组的新元素。

* 起始位置如果是负数，就表示从倒数位置开始删除。
* 如果只是单纯地插入元素，`splice`方法的第二个参数可以设为`0`。
* 如果只提供第一个参数，等同于将原数组在指定位置拆分成两个数组。

##### flat(), flatMap()

数组的成员有时还是数组，`Array.prototype.flat()`用于将嵌套的数组“拉平”，变成一维的数组。该方法返回一个新数组，对原数据没有影响。

flat()接收一个参数，表示“拉平”嵌套数组的层数。

* 如果不管有多少层嵌套，都要转成一维数组，可以用`Infinity`关键字作为参数。
* 如果原数组有空位，`flat()`方法会跳过空位。

`flatMap()`方法对原数组的每个成员执行一个函数（相当于执行`Array.prototype.map()`），然后对返回值组成的数组执行`flat()`方法。

* `flatMap()`只能展开一层数组。
* `flatMap()`方法还可以有第二个参数，用来绑定遍历函数里面的`this`。

#### 顺序

##### sort()

`sort`方法对数组成员进行排序，默认是按照字典顺序排序，返回排序后数组。

如果要按照大小排序，需要传入一个函数。这个函数中的a、b分别表示数组中靠前和靠后的项，如果需要将它们交换位置，则返回任意正数。

> 为了实现排序，sort()方法会调用每个数组项的toString()转型方法，然后比较得到的字符串，以确定如何排序。即使数组中的每一项都是数值，sort()方法比较的也是字符串

##### reverse()

`reverse`方法用于颠倒排列数组元素，返回改变后的数组。注意，该方法将改变原数组。

#### 获取元素

##### at()

[ES2022](https://github.com/tc39/proposal-relative-indexing-method/) 为数组实例增加了`at()`方法，接受一个整数作为参数，返回对应位置的成员，并支持负索引。这个方法不仅可用于数组，也可用于字符串和类型数组（TypedArray）。

如果参数位置超出了数组范围，`at()`返回`undefined`。

##### indexOf(), lastIndexOf()

> indexOf、lastIndexOf都是严格相等搜索方法，严格相等内部使用===判断元素是否存在，无法使用NaN。

`indexOf`方法返回给定元素在数组中第一次出现的位置，如果没有出现则返回`-1`。

`lastIndexOf`方法返回给定元素在数组中最后一次出现的位置，如果没有出现则返回`-1`。

第一个参数是要查找的项，第二个是查找项的起点位置的索引。如果查找到该项，则返回它从查找位置起，首次出现的位置。

##### includes()

第一个参数是待搜索元素，第二个参数是开始搜索的位置，默认从0开始，如果为负数则表示倒数的位置，如果大于数组长度重置从0开始。判断标准遵循严格相等，对于NaN判断自等。 

##### find(), findIndex()

find、findIndex使用了断言函数。这两个方法的第一个参数是断言函数，第二个可选参数用于指定this。find()返回第一个断言函数返回值为true的元素，findIndex()返回第一个匹配元素的索引。

> 断言函数接收3个参数：元素、索引和数组本身。其中元素是数组中当前搜索的元素，索引是当前元素的索引，而数组就是正在搜索的数组。断言函数返回真值，表示是否匹配。

[ES2022](https://github.com/tc39/proposal-array-find-from-last) 新增了两个方法`findLast()`和`findLastIndex()`，从数组的最后一个成员开始，依次向前检查，其他都保持不变。

#### 转换元素

##### toString()

无参数，返回每个元素调用toString()后使用`,`拼接后的字符串。

##### valueOf()

返回数组本身。

##### toLocaleString()

返回每个元素调用toLocaleString()后使用`,`拼接的值。

##### join()

join()以指定参数作为分隔符，将所有数组成员连接为一个字符串返回。如果留空则默认以逗号分隔，如同调用toString()方法。

如果数组成员是`undefined`或`null`或空位，会被转成空字符串。

##### reduce(), reduceRight()

`reduce`、`reduceRight`方法返回一个值，这个值是函数参数对数组所有元素进行处理累计的结果。`reduce`会从左到右处理元素，`reduceRight`会从右到左。

第一个参数是个函数，该函数接收四个参数：

1. 第一个参数的值是上次处理的结果
2. 第二个参数的值是数组元素
3. 第三个参数的值是迭代的元素的位置
4. 第四个参数的值是数组本身

第二个参数是初始值，如果不指定，默认将数组第一个元素作为初始值。

* 由于空数组取不到累积变量的初始值，`reduce()`方法会报错。这时，加上第二个参数，就能保证总是会返回一个值。
* 只有一个初始值的情况下，回调函数不会执行，会直接返回

#### 迭代元素

数组迭代方法要求传入一个函数A作为参数，A自身参数由迭代方法传入，分别是item(数组元素)、index(数组下标)、array(数组自身)。迭代方法有第二个可选参数用于指定this。

forEach()、map()、filter()会跳过数组空位。

| 方法      | 说明                                                     |
| --------- | -------------------------------------------------------- |
| filter()  | A需要返回bool值，返回A返回值为true的元素的数组           |
| every()   | A需要返回bool值，如果A对每个元素的返回值为true则返回true |
| forEach() | A无需返回值，该方法无返回值                              |
| map()     | A需要返回一个值，方法返回由A返回值构成的数组             |
| some()    | A需要返回bool值，如果A对一个元素的返回值为true则返回true |

##### entries(), keys(), values()

ES6 提供三个新的方法——`entries()`，`keys()`和`values()`——用于遍历数组。它们都返回一个遍历器对象，可以用`for...of`循环进行遍历，唯一的区别是`keys()`是对键名的遍历、`values()`是对键值的遍历，`entries()`是对键值对的遍历。

##### map()

`map()`方法将数组的所有成员依次传入参数函数，然后把每一次的执行结果组成一个新数组返回。

* 如果数组有空位，`map()`方法的回调函数在这个位置不会执行，会跳过数组的空位。

### 提案

#### toReversed(), toSorted(), toSpliced(), with()

现在有一个[提案](https://github.com/tc39/proposal-change-array-by-copy)，允许对数组进行操作时，不改变原数组，而返回一个原数组的拷贝。

- `toReversed()`对应`reverse()`，用来颠倒数组成员的位置。
- `toSorted()`对应`sort()`，用来对数组成员排序。
- `toSpliced()`对应`splice()`，用来在指定位置，删除指定数量的成员，并插入新成员。
- `with(index, value)`对应`splice(index, 1, value)`，用来将指定位置的成员替换为新的值。

#### goup(), groupToMap()

有一个[提案](https://github.com/tc39/proposal-array-grouping)，为 JavaScript 新增了数组实例方法`group()`和`groupToMap()`，它们可以根据分组函数的运行结果，将数组成员分组。

`group()`的参数是一个分组函数，原数组的每个成员都会依次执行这个函数，确定自己是哪一个组。

`group()`的分组函数可以接受三个参数，依次是数组的当前成员、该成员的位置序号、原数组。分组函数的返回值应该是字符串（或者可以自动转为字符串），以作为分组后的组名。

`group()`的返回值是一个对象，该对象的键名就是每一组的组名，即分组函数返回的每一个字符串；该对象的键值是一个数组，包括所有产生当前键名的原数组成员。

`group()`还可以接受一个对象，作为第二个参数。该对象会绑定分组函数（第一个参数）里面的`this`。

`groupToMap()`的作用和用法与`group()`完全一致，唯一的区别是返回值是一个 Map 结构，而不是对象。Map 结构的键名可以是各种值，所以不管分组函数返回什么值，都会直接作为组名（Map 结构的键名），不会强制转为字符串。

