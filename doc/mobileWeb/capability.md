# 性能优化

性能是网页的响应速度。

> 网页的响应包括两个方面：
>
> 1. 打开网页到网页能够正常使用的时间
> 2. 网页交互的流畅程度

根据网页访问过程，可以将性能优化策略分为三类：网页资源请求与加载类、网页渲染类、JavaScript脚本类。

## HTML的性能优化

### CSS和JavaScript

**引入方式**

html中的css和JavaScript主要使用两种方式引入：内联和外部文件。

|      | 内联                               | 外部文件                                   |
| ---- | ---------------------------------- | ------------------------------------------ |
| 优点 | 减少HTTP请求                       | 复用性好，利用浏览器静态资源缓存，便于维护 |
| 缺点 | 复用性差，文件变大导致加载时间变长 | 增加HTTP请求                               |

使用哪种引入方式需要根据具体情况确定，一般内联首屏的css和JavaScript。

> 首屏：打开网页后，在屏幕上显示的网页内容称为首屏。

**位置**

css引入语句要放在html的head内。

与dom操作相关的js文件引入语句放在html的最后，与dom无关或者希望代码尽早执行的js文件在最开始引入。

**其他**

* 压缩

  在项目上线之前，需要将css、js代码合并压缩，减少文件大小

* 合并

  如果外部引入文件数量过多，需要对这些文件合并。

* 缓存

  后端设置浏览器缓存，防止已请求的资源再次请求。

### 图片

**图片大**

1. 图片压缩

   使用更高压缩比格式的图片，如webP。

2. 少用图片

   图标字体代替图片

   CSS画图

**图片多**

1. 合理使用base64内嵌图片

2. 合并静态资源图片

   精灵图

### 其他

* 主要内容html代码写的位置要靠前
* 嵌套层级不能过多
* table和iframe是慢加载，只有该标签内容解析完了才显示，不推荐使用

## css性能优化

#### 选择器

* 选择器要简化，只要它能够确定选中的元素
* 不要使用通配符
* 如果选择器内无样式，需要删除
* 属性选择器会使性能下降

#### 属性

* 如果各选择器样式有相同部分，可以将这些部分提取，使用并集选择器
* 合并属性

## JavaScript性能优化

### DOM操作

DOM操作是很耗性能的行为。DOM操作优化可以从加快单次DOM操作和减少DOM操作次数两方面入手。

**加快单次操作**

* 使用ID获取dom元素
* 查找方法的主体是dom元素，不一定要document

**减少操作次数**

* 使用变量存储获取到的dom元素
* 克隆快于创建
* 修改dom元素样式通过添加或删除class实现

## 事件优化

* 事件委托

  如果某父元素中的子元素都需要绑定事件，可以将事件绑定在父元素上。

* 事件稀释

  对于在短时间内会触发很多次的事件，可以通过使用定时器减少触发次数。

  ```javascript
  var timer = null;
  window.addEventListener("scroll",function(){
    clearTimeout(timer);
    timer = setTimeout(function(){},100);
  })
  ```

## 资源加载

* 按需加载

  当资源需要出现在可视区时，再去加载资源。

  如果页面中含有很多的图片，可以使用按需加载的方式加载图片。

* 预加载

  当浏览器有空闲时，加载之后需要用到的资源。